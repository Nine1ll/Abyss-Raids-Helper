(()=>{"use strict";function e(r){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(r)}function r(r){var t=function(r,t){if("object"!=e(r)||!r)return r;var o=r[Symbol.toPrimitive];if(void 0!==o){var n=o.call(r,t||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(r)}(r,"string");return"symbol"==e(t)?t:t+""}function t(e,t,o){return(t=r(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function n(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach(function(r){t(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const a={},l=(e,r)=>{const t=[];for(let o=0;o<r.length;o+=1)for(let e=0;e<r[o].length;e+=1)r[o][e]&&t.push({row:o,col:e});a[e]={key:e,matrix:r,cells:t,height:r.length,width:r[0].length,area:t.length}};l("1_dot",[[1]]),l("2_bar_h",[[1,1]]),l("2_bar_v",[[1],[1]]),l("3_bar_h",[[1,1,1]]),l("3_bar_v",[[1],[1],[1]]),l("3_L_nw",[[1,0],[1,1]]),l("3_L_ne",[[0,1],[1,1]]),l("3_L_sw",[[1,1],[1,0]]),l("3_L_se",[[1,1],[0,1]]),l("4_square",[[1,1],[1,1]]),l("4_bar_h",[[1,1,1,1]]),l("4_bar_v",[[1],[1],[1],[1]]),l("4_T_up",[[0,1,0],[1,1,1]]),l("4_T_down",[[1,1,1],[0,1,0]]),l("4_T_left",[[0,1],[1,1],[0,1]]),l("4_T_right",[[1,0],[1,1],[1,0]]),l("4_L_tall_sw",[[1,0],[1,0],[1,1]]),l("4_L_tall_se",[[0,1],[0,1],[1,1]]),l("4_L_tall_nw",[[1,1],[0,1],[0,1]]),l("4_L_tall_ne",[[1,1],[1,0],[1,0]]),l("4_L_wide_sw",[[1,1,1],[1,0,0]]),l("4_L_wide_se",[[1,1,1],[0,0,1]]),l("4_L_wide_nw",[[1,0,0],[1,1,1]]),l("4_L_wide_ne",[[0,0,1],[1,1,1]]),l("5_plus",[[0,1,0],[1,1,1],[0,1,0]]),l("5_N_nw",[[0,1,1],[0,1,0],[1,1,0]]),l("5_N_ne",[[1,1,0],[0,1,0],[0,1,1]]),l("5_N_sw",[[1,0,0],[1,1,1],[0,0,1]]),l("5_N_se",[[0,0,1],[1,1,1],[1,0,0]]),l("5_L_up",[[1,1,1],[1,0,0],[1,0,0]]),l("5_L_right",[[1,1,1],[0,0,1],[0,0,1]]),l("5_L_down",[[1,0,0],[1,0,0],[1,1,1]]),l("5_L_left",[[0,0,1],[0,0,1],[1,1,1]]),l("5_T_up",[[1,1,1],[0,1,0],[0,1,0]]),l("5_T_right",[[0,0,1],[1,1,1],[0,0,1]]),l("5_T_down",[[0,1,0],[0,1,0],[1,1,1]]),l("5_T_left",[[1,0,0],[1,1,1],[1,0,0]]),l("5_U_down",[[1,0,1],[1,1,1]]),l("5_U_up",[[1,1,1],[1,0,1]]),l("5_U_left",[[1,1],[0,1],[1,1]]),l("5_U_right",[[1,1],[1,0],[1,1]]),l("8_snake_v",[[1,0],[1,1],[1,1],[1,1],[0,1]]),l("8_snake_h",[[0,1,1,1,1],[1,1,1,1,0]]),l("8_rect_v",[[1,1],[1,1],[1,1],[1,1]]),l("8_rect_h",[[1,1,1,1],[1,1,1,1]]),l("8_plus_big",[[0,1,0],[1,1,1],[1,1,1],[0,1,0]]),l("8_ring_h",[[0,1,1,0],[1,1,1,1],[0,1,1,0]]),l("8_T_up",[[1,1,1,1],[0,1,1,0],[0,1,1,0]]),l("8_T_down",[[0,1,1,0],[0,1,1,0],[1,1,1,1]]);const c=a,s=(Object.values(a).map(e=>({key:e.key,label:"".concat(e.key," (").concat(e.area,"\uce78)"),area:e.area,matrix:e.matrix,width:e.width,height:e.height})),{rare:{label:"\ub808\uc5b4",color:"#3b82f6",points:30,maxCells:3},epic:{label:"\uc5d0\ud53d",color:"#8b5cf6",points:60,maxCells:4},super_epic:{label:"\uc288\ud37c\uc5d0\ud53d",color:"#ef4444",points:120,maxCells:5},unique:{label:"\uc720\ub2c8\ud06c",color:"#facc15",points:250,maxCells:null}}),i=e=>{if(!e||e<9)return 0;const r=Math.min(e,21)-9;return 265*(1+Math.floor(r/3))},f=e=>{let{rows:r,cols:t,blocked:o=[],pieces:a=[],role:l,maxDepth:f=15}=e;const u=r*t;if(u<=0)return{totalScore:0,baseScore:0,bonusScore:0,placements:[],bonusBreakdown:[]};const _=Array.from({length:r},(e,r)=>Array.from({length:t},(e,o)=>((e,r,t)=>1n<<BigInt(e*t+r))(r,o,t))),b=Array.from({length:r},()=>Array(t).fill(0)),m=[],p=new Map;let d=0n,h=0n;for(let n=0;n<r;n+=1)for(let e=0;e<t;e+=1){const r=n*t+e,o=_[n][e];b[n][e]=r,m[r]=o,p.set(o,r),d|=o}o.forEach(e=>{let{row:o,col:n}=e;if(o>=0&&o<r&&n>=0&&n<t){const e=_[o][n];h|=e}});const g=new Map,y=[];if(a.forEach((e,o)=>{if(!e||e.role!==l)return;const n=Math.max(0,Number(e.quantity)||0);if(n<=0)return;const a=c[e.shapeKey];if(!a)return;const i=s[e.grade],f=null===i||void 0===i?void 0:i.maxCells;if(f&&a.area>f)return;const u=(e=>{if(g.has(e.key))return g.get(e.key);const o=[];for(let n=0;n<=r-e.height;n+=1)for(let r=0;r<=t-e.width;r+=1){let t=0n;const a=[],l=[];let c=!0;for(let o=0;o<e.cells.length;o+=1){const s=e.cells[o],i=n+s.row,f=r+s.col,u=_[i][f];if(0n!==(h&u)){c=!1;break}t|=u,a.push([i,f]),l.push(b[i][f])}c&&o.push({mask:t,cells:a,cellIndexes:l})}return g.set(e.key,o),o})(a);if(!u.length)return;const m=((e,r)=>{const t=s[e];return t?t.points*r:0})(e.grade,a.area),p={uid:e.id||"".concat(e.shapeKey,"-").concat(o),modifier:e.modifier,grade:e.grade,gradeLabel:(null===i||void 0===i?void 0:i.label)||e.grade,shapeKey:e.shapeKey,area:a.area,baseScore:m,placements:u,placementsByCell:new Map,remaining:n,used:0};u.forEach(e=>{e.cellIndexes.forEach(r=>{p.placementsByCell.has(r)||p.placementsByCell.set(r,[]),p.placementsByCell.get(r).push(e)})}),y.push(p)}),!y.length)return{totalScore:0,baseScore:0,bonusScore:0,placements:[],bonusBreakdown:[]};const w=new Array(u).fill(0);y.forEach(e=>{e.placements.forEach(r=>{r.cellIndexes.forEach(r=>{w[r]+=e.remaining})})});const S={};let k=0;y.forEach(e=>{k+=e.baseScore*e.remaining,S[e.modifier]=(S[e.modifier]||0)+e.area*e.remaining}),y.sort((e,r)=>r.area!==e.area?r.area-e.area:r.baseScore!==e.baseScore?r.baseScore-e.baseScore:e.modifier.localeCompare(r.modifier,"ko-KR"));const v={},O=[];let L={totalScore:0,baseScore:0,bonusScore:0,placements:[],bonusBreakdown:[]};const j=new Map,x=e=>{const{totalBonus:r,breakdown:t}=(e=>{const r=[];let t=0;return Object.entries(e).forEach(e=>{let[o,n]=e;const a=i(n);a>0&&(r.push({modifier:o,cells:Math.min(n,21),bonus:a}),t+=a)}),{totalBonus:t,breakdown:r}})(v),o=e+r;var a;o>L.totalScore&&(L={totalScore:o,baseScore:e,bonusScore:r,placements:(a=O,a.map(e=>n(n({},e),{},{cells:e.cells.map(e=>{let[r,t]=e;return[r,t]})}))),bonusBreakdown:t})},E=function(e,r,t){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(o>f)return void x(r);const n=r+t+(()=>{let e=0;return Object.keys(S).forEach(r=>{const t=S[r];if(!t)return;const o=v[r]||0,n=Math.min(o+t,21);e+=i(n)-i(o)}),e})();if(n<=L.totalScore)return;const a=e.toString(16),l=j.get(a);if("undefined"!==typeof l&&n<=l)return;j.set(a,n),x(r);const c=d&~e;if(0n===c)return;const s=(e=>{let r=0n,t=Number.POSITIVE_INFINITY;for(let o=0;o<u;o+=1){const n=m[o];if(0n===(e&n))continue;const a=w[o];if(0===a)return n;if(a<t&&(t=a,r=n,1===a))break}return r||e&-e})(c);if(0n===s)return;const _=p.get(s);if("undefined"!==typeof _){for(let n=0;n<y.length;n+=1){const a=y[n];if(a.remaining<=0)continue;const l=a.placementsByCell.get(_);if(l&&l.length)for(let n=0;n<l.length;n+=1){const c=l[n];if(0n!==(c.mask&e))continue;a.remaining-=1;const s="".concat(a.uid,"-").concat(a.used);a.used+=1,v[a.modifier]=(v[a.modifier]||0)+a.area,S[a.modifier]=Math.max(0,(S[a.modifier]||0)-a.area),O.push({id:s,label:"".concat(a.modifier," \xb7 ").concat(a.gradeLabel," \xb7 ").concat(a.area,"\uce78"),grade:a.grade,modifier:a.modifier,baseScore:a.baseScore,shapeKey:a.shapeKey,cells:c.cells}),E(e|c.mask,r+a.baseScore,t-a.baseScore,o+1),O.pop(),v[a.modifier]-=a.area,v[a.modifier]<=0&&delete v[a.modifier],S[a.modifier]=(S[a.modifier]||0)+a.area,a.used-=1,a.remaining+=1}}E(e|s,r,t,o+1)}else E(e|s,r,t,o+1)};return E(h,0,k,0),L};self.onmessage=function(e){const{rows:r,cols:t,blocked:o,pieces:n,role:a}=e.data,l=f({rows:r,cols:t,blocked:o,pieces:n,role:a});self.postMessage({result:l})}})();
//# sourceMappingURL=991.b7fb29c7.chunk.js.map
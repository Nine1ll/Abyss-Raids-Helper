(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}function r(e,r,n){return(r=t(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}const a={},i=(e,t)=>{const r=[];for(let n=0;n<t.length;n+=1)for(let e=0;e<t[n].length;e+=1)t[n][e]&&r.push({row:n,col:e});a[e]={key:e,matrix:t,cells:r,height:t.length,width:t[0].length,area:r.length}};i("1_dot",[[1]]),i("2_bar_h",[[1,1]]),i("2_bar_v",[[1],[1]]),i("3_bar_h",[[1,1,1]]),i("3_bar_v",[[1],[1],[1]]),i("3_L_nw",[[1,0],[1,1]]),i("3_L_ne",[[0,1],[1,1]]),i("3_L_sw",[[1,1],[1,0]]),i("3_L_se",[[1,1],[0,1]]),i("4_square",[[1,1],[1,1]]),i("4_bar_h",[[1,1,1,1]]),i("4_bar_v",[[1],[1],[1],[1]]),i("4_T_up",[[0,1,0],[1,1,1]]),i("4_T_down",[[1,1,1],[0,1,0]]),i("4_T_left",[[0,1],[1,1],[0,1]]),i("4_T_right",[[1,0],[1,1],[1,0]]),i("4_L_tall_sw",[[1,0],[1,0],[1,1]]),i("4_L_tall_se",[[0,1],[0,1],[1,1]]),i("4_L_tall_nw",[[1,1],[0,1],[0,1]]),i("4_L_tall_ne",[[1,1],[1,0],[1,0]]),i("4_L_wide_sw",[[1,1,1],[1,0,0]]),i("4_L_wide_se",[[1,1,1],[0,0,1]]),i("4_L_wide_nw",[[1,0,0],[1,1,1]]),i("4_L_wide_ne",[[0,0,1],[1,1,1]]),i("5_plus",[[0,1,0],[1,1,1],[0,1,0]]),i("5_N_nw",[[0,1,1],[0,1,0],[1,1,0]]),i("5_N_ne",[[1,1,0],[0,1,0],[0,1,1]]),i("5_N_sw",[[1,0,0],[1,1,1],[0,0,1]]),i("5_N_se",[[0,0,1],[1,1,1],[1,0,0]]),i("5_L_up",[[1,1,1],[1,0,0],[1,0,0]]),i("5_L_right",[[1,1,1],[0,0,1],[0,0,1]]),i("5_L_down",[[1,0,0],[1,0,0],[1,1,1]]),i("5_L_left",[[0,0,1],[0,0,1],[1,1,1]]),i("5_T_up",[[1,1,1],[0,1,0],[0,1,0]]),i("5_T_right",[[0,0,1],[1,1,1],[0,0,1]]),i("5_T_down",[[0,1,0],[0,1,0],[1,1,1]]),i("5_T_left",[[1,0,0],[1,1,1],[1,0,0]]),i("5_U_down",[[1,0,1],[1,1,1]]),i("5_U_up",[[1,1,1],[1,0,1]]),i("5_U_left",[[1,1],[0,1],[1,1]]),i("5_U_right",[[1,1],[1,0],[1,1]]),i("8_snake_v",[[1,0],[1,1],[1,1],[1,1],[0,1]]),i("8_snake_h",[[0,1,1,1,1],[1,1,1,1,0]]),i("8_rect_v",[[1,1],[1,1],[1,1],[1,1]]),i("8_rect_h",[[1,1,1,1],[1,1,1,1]]),i("8_plus_big",[[0,1,0],[1,1,1],[1,1,1],[0,1,0]]),i("8_ring_h",[[0,1,1,0],[1,1,1,1],[0,1,1,0]]),i("8_T_up",[[1,1,1,1],[0,1,1,0],[0,1,1,0]]),i("8_T_down",[[0,1,1,0],[0,1,1,0],[1,1,1,1]]);const l=a,c=(Object.values(a).map(e=>({key:e.key,label:"".concat(e.key," (").concat(e.area,"\uce78)"),area:e.area,matrix:e.matrix,width:e.width,height:e.height})),{rare:{label:"\ub808\uc5b4",color:"#3b82f6",points:30,maxCells:3},epic:{label:"\uc5d0\ud53d",color:"#8b5cf6",points:60,maxCells:4},super_epic:{label:"\uc288\ud37c\uc5d0\ud53d",color:"#ef4444",points:120,maxCells:5},unique:{label:"\uc720\ub2c8\ud06c",color:"#facc15",points:250,maxCells:null}}),s=e=>{if(!e||e<9)return 0;const t=Math.min(e,21)-9;return 265*(1+Math.floor(t/3))},u=e=>{let{rows:t,cols:r,blocked:n=[],pieces:a=[],role:i}=e;const u=t*r;if(u<=0)return{totalScore:0,baseScore:0,bonusScore:0,placements:[],bonusBreakdown:[]};const f=Array.from({length:t},(e,t)=>Array.from({length:r},(e,n)=>((e,t,r)=>1n<<BigInt(e*r+t))(t,n,r))),_=Array.from({length:t},()=>Array(r).fill(0)),b=[],m=new Map;let d=0n,p=0n;for(let o=0;o<t;o+=1)for(let e=0;e<r;e+=1){const t=o*r+e,n=f[o][e];_[o][e]=t,b[t]=n,m.set(n,t),d|=n}n.forEach(e=>{let{row:n,col:o}=e;if(n>=0&&n<t&&o>=0&&o<r){const e=f[n][o];p|=e}});const h=new Map,g=[];if(a.forEach((e,n)=>{if(!e||e.role!==i)return;const o=Math.max(0,Number(e.quantity)||0);if(o<=0)return;const a=l[e.shapeKey];if(!a)return;const s=c[e.grade],u=null===s||void 0===s?void 0:s.maxCells;if(u&&a.area>u)return;const b=(e=>{if(h.has(e.key))return h.get(e.key);const n=[];for(let o=0;o<=t-e.height;o+=1)for(let t=0;t<=r-e.width;t+=1){let r=0n;const a=[],i=[];let l=!0;for(let n=0;n<e.cells.length;n+=1){const c=e.cells[n],s=o+c.row,u=t+c.col,b=f[s][u];if(0n!==(p&b)){l=!1;break}r|=b,a.push([s,u]),i.push(_[s][u])}l&&n.push({mask:r,cells:a,cellIndexes:i})}return h.set(e.key,n),n})(a);if(!b.length)return;const m="unique"===e.grade,d=m?Math.min(o,1):o,y=((e,t)=>{const r=c[e];return r?r.points*t:0})(e.grade,a.area),w={uid:e.id||"".concat(e.shapeKey,"-").concat(n),modifier:m?"-":e.modifier,grade:e.grade,gradeLabel:(null===s||void 0===s?void 0:s.label)||e.grade,shapeKey:e.shapeKey,area:a.area,baseScore:y,placements:b,placementsByCell:new Map,remaining:d,used:0,isUnique:m};b.forEach(e=>{e.cellIndexes.forEach(t=>{w.placementsByCell.has(t)||w.placementsByCell.set(t,[]),w.placementsByCell.get(t).push(e)})}),g.push(w)}),!g.length)return{totalScore:0,baseScore:0,bonusScore:0,placements:[],bonusBreakdown:[]};const y=new Array(u).fill(0);g.forEach(e=>{e.placements.forEach(t=>{t.cellIndexes.forEach(t=>{y[t]+=e.remaining})})});const w={};let S=0;g.forEach(e=>{S+=e.baseScore*e.remaining,e.isUnique||(w[e.modifier]=(w[e.modifier]||0)+e.area*e.remaining)}),g.sort((e,t)=>t.area!==e.area?t.area-e.area:t.baseScore!==e.baseScore?t.baseScore-e.baseScore:e.modifier.localeCompare(t.modifier,"ko-KR"));const k={},v=[];let O={totalScore:0,baseScore:0,bonusScore:0,placements:[],bonusBreakdown:[]};const L=new Map,j=e=>{const{totalBonus:t,breakdown:r}=(e=>{const t=[];let r=0;return Object.entries(e).forEach(e=>{let[n,o]=e;const a=s(o);a>0&&(t.push({modifier:n,cells:Math.min(o,21),bonus:a}),r+=a)}),{totalBonus:r,breakdown:t}})(k),n=e+t;var a;n>O.totalScore&&(O={totalScore:n,baseScore:e,bonusScore:t,placements:(a=v,a.map(e=>o(o({},e),{},{cells:e.cells.map(e=>{let[t,r]=e;return[t,r]})}))),bonusBreakdown:r})},E=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=t+r+(()=>{let e=0;return Object.keys(w).forEach(t=>{const r=w[t];if(!r)return;const n=k[t]||0,o=Math.min(n+r,21);e+=s(o)-s(n)}),e})();if(a<=O.totalScore)return;const i=e.toString(16)+"|"+n,l=L.get(i);if("undefined"!==typeof l&&a<=l)return;L.set(i,a),j(t);const c=d&~e;if(0n===c)return;const f=(e=>{let t=0n,r=Number.POSITIVE_INFINITY;for(let n=0;n<u;n+=1){const o=b[n];if(0n===(e&o))continue;const a=y[n];if(0===a)return o;if(a<r&&(r=a,t=o,1===a))break}return t||e&-e})(c);if(0n===f)return;const _=m.get(f);if("undefined"!==typeof _){for(let a=0;a<g.length;a+=1){const i=g[a];if(i.remaining<=0)continue;if(i.isUnique&&n>=1)continue;const l=i.placementsByCell.get(_);if(l&&l.length)for(let a=0;a<l.length;a+=1){const c=l[a];if(0n!==(c.mask&e))continue;i.remaining-=1;const s="".concat(i.uid,"-").concat(i.used);i.used+=1,i.isUnique||(k[i.modifier]=(k[i.modifier]||0)+i.area,w[i.modifier]=Math.max(0,(w[i.modifier]||0)-i.area)),v.push({id:s,label:i.isUnique?"".concat(i.gradeLabel," \xb7 ").concat(i.area,"\uce78"):"".concat(i.modifier," \xb7 ").concat(i.gradeLabel," \xb7 ").concat(i.area,"\uce78"),grade:i.grade,modifier:i.modifier,baseScore:i.baseScore,shapeKey:i.shapeKey,cells:c.cells});const u=e|c.mask,f=t+i.baseScore,_=r-i.baseScore;i.isUnique?E(u,f,_,n+1,o+1):E(u,f,_,n,o+1),v.pop(),i.isUnique||(k[i.modifier]-=i.area,k[i.modifier]<=0&&delete k[i.modifier],w[i.modifier]=(w[i.modifier]||0)+i.area),i.used-=1,i.remaining+=1}}E(e|f,t,r,n,o+1)}else E(e|f,t,r,n,o+1)};return E(p,0,S,0,0),O};self.onmessage=function(e){const{rows:t,cols:r,blocked:n,pieces:o,role:a}=e.data,i=u({rows:t,cols:r,blocked:n,pieces:o,role:a});self.postMessage({result:i})}})();
//# sourceMappingURL=991.0fc13800.chunk.js.map